<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro Sizer - Layout Final Fix</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background: radial-gradient(circle at top right, #1e293b, #0f172a); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; color: #ffffff; }
        .card { width: 100%; max-width: 400px; background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); padding: 25px; border-radius: 35px; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7); }
        
        .header { text-align: center; margin-bottom: 20px; }
        .app-title { color: #4ade80; font-size: 1.1rem; font-weight: 700; letter-spacing: 0.5px; }

        .margin-selector { display: flex; background: rgba(15, 23, 42, 0.5); border-radius: 12px; padding: 4px; margin-bottom: 20px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .margin-btn { flex: 1; padding: 10px; border: none; background: none; color: #94a3b8; font-size: 0.75rem; font-weight: 700; cursor: pointer; border-radius: 8px; transition: 0.3s; }
        .margin-btn.active { background: #f97316; color: white; }

        .group { display: flex; flex-direction: column; position: relative; margin-bottom: 12px; }
        label { font-size: 0.65rem; color: #94a3b8; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; }
        input { background: rgba(15, 23, 42, 0.5); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 12px; font-size: 1rem; width: 100%; outline: none; color: #ffffff; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .risk-top-label { position: absolute; right: 5px; top: 0; font-size: 0.7rem; color: #FF0000; font-weight: 900; }

        /* --- UI Fix for Large Numbers --- */
        .res-section { 
            text-align: center; 
            margin: 15px 0; 
            padding: 25px 10px; 
            background: rgba(255, 255, 255, 0.02); 
            border-radius: 25px; 
            border: 1px solid rgba(255, 255, 255, 0.03); 
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 180px;
        }
        
        .trade-type-badge { position: absolute; top: 15px; left: 15px; font-size: 0.6rem; padding: 3px 8px; border-radius: 5px; font-weight: 900; }
        .type-long { background: #4ade80; color: #000000; }
        .type-short { background: #FF0000; color: #FFFFFF; }
        
        .res-val { 
            font-size: clamp(1.8rem, 8vw, 3.2rem); 
            font-weight: 900; 
            color: #4ade80; 
            line-height: 1; 
            margin-top: 15px;
            word-break: break-all;
        }
        
        .res-label { color: #94a3b8; font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        
        .liq-box { 
            padding: 12px; 
            background: rgba(248, 113, 113, 0.05); 
            border-radius: 12px; 
            border: 1px dashed rgba(248, 113, 113, 0.2); 
            width: 100%;
        }
        .liq-price { color: #FF0000; font-weight: 900; font-size: clamp(0.9rem, 4vw, 1.3rem); }
        .liq-label { font-size: 0.6rem; color: #94a3b8; text-transform: uppercase; font-weight: 700; margin-bottom: 3px; }

        .action-row { display: flex; justify-content: center; gap: 15px; margin-top: 5px; }
        .action-btn { width: 42px; height: 42px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #ffffff; cursor: pointer; transition: 0.2s; }
        .action-btn:active { transform: scale(0.9); }

        .swap-row { display: flex; align-items: flex-end; gap: 12px; margin: 15px 0; }
        .swap-icon { color: #f97316; padding-bottom: 12px; cursor: pointer; font-size: 1.1rem; }

        .stats-box { background: rgba(0, 0, 0, 0.2); border-radius: 20px; display: grid; grid-template-columns: 1fr 1.3fr; overflow: hidden; border: 1px solid rgba(255, 255, 255, 0.05); }
        .tgt-part { padding: 12px; border-right: 1px solid rgba(255, 255, 255, 0.05); }
        .det-part { padding: 12px; }
        .det-row { display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.85rem; color: #94a3b8; }
        .val-green { color: #4ade80; font-weight: 800; }
        .val-red { color: #FF0000; font-weight: 900; }
        .val-orange { color: #f97316; font-weight: 800; }
    </style>
</head>
<body>

<div class="card">
    <div class="header"><p class="app-title">PRO POSITION SIZER</p></div>

    <div class="margin-selector">
        <button class="margin-btn active" id="btn-isolated" onclick="setMarginMode('isolated')">ISOLATED</button>
        <button class="margin-btn" id="btn-cross" onclick="setMarginMode('cross')">CROSS</button>
    </div>

    <div class="group" id="cross-balance-group" style="display:none;">
        <label>Total Wallet Balance (USDT)</label>
        <input type="text" id="v_wallet" placeholder="0.00" oninput="handleFormatInput(this)">
    </div>

    <div class="grid">
        <div class="group"><label>Capital</label><input type="text" id="v_cap" placeholder="0" oninput="handleFormatInput(this)"></div>
        <div class="group">
            <label>Risk %</label><span class="risk-top-label" id="v_risk_top">$0</span>
            <input type="text" id="v_riskP" placeholder="0" oninput="handleFormatInput(this)">
        </div>
        <div class="group"><label>Entry Price</label><input type="text" id="v_entry" placeholder="0" oninput="handleFormatInput(this)"></div>
        <div class="group"><label>Stop Loss</label><input type="text" id="v_sl" placeholder="0" oninput="handleFormatInput(this)"></div>
    </div>

    <div class="res-section">
        <div id="type-badge" class="trade-type-badge" style="display:none;">LONG</div>
        <div class="res-val" id="res_size">0</div>
        <p class="res-label">Position Size (Units)</p>
        <div class="liq-box">
            <p class="liq-label" id="liq-type-label">Isolated Liquidation</p>
            <p class="liq-price" id="v_liq">0.0000</p>
        </div>
        <div class="action-row">
            <div class="action-btn" title="Copy" onclick="copySize()"><i class="fa-regular fa-copy"></i></div>
            <div class="action-btn" title="Reset" onclick="resetForm()"><i class="fa-solid fa-arrows-rotate"></i></div>
        </div>
    </div>

    <div class="swap-row">
        <div class="group" style="flex:1"><label id="lbl_left">Trade Amount</label><input type="text" id="in_left" readonly></div>
        <div class="swap-icon" onclick="swapFields()"><i class="fa-solid fa-repeat"></i></div>
        <div class="group" style="flex:1"><label id="lbl_right">Leverage</label><input type="text" id="in_right" oninput="handleFormatInput(this)"></div>
    </div>

    <div class="stats-box">
        <div class="tgt-part">
            <label style="font-size:0.55rem;">TP PRICE</label>
            <input type="text" id="v_target" style="width:100%; padding:8px; border-radius:8px; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1); color:white; outline:none;" placeholder="0.00" oninput="handleFormatInput(this)">
        </div>
        <div class="det-part">
            <div class="det-row">Profit <span class="val-green" id="v_profit">0</span></div>
            <div class="det-row">Risk <span class="val-red" id="v_risk_amt">0</span></div>
            <div class="det-row">Ratio <span class="val-orange" id="v_rr">0</span></div>
        </div>
    </div>
</div>

<script>
    let marginMode = 'isolated';

    function formatNumberWithCommas(value) {
        if (!value && value !== 0) return "";
        let parts = value.toString().split(".");
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        return parts.join(".");
    }

    function parseFormattedNumber(value) {
        if (!value) return 0;
        return parseFloat(value.toString().replace(/,/g, ''));
    }

    function handleFormatInput(el) {
        let cursorPosition = el.selectionStart;
        let originalLength = el.value.length;
        let cleanValue = el.value.replace(/[^0-9.]/g, '');
        el.value = formatNumberWithCommas(cleanValue);
        let newLength = el.value.length;
        cursorPosition = cursorPosition + (newLength - originalLength);
        el.setSelectionRange(cursorPosition, cursorPosition);
        calculate();
    }

    function setMarginMode(mode) {
        marginMode = mode;
        document.getElementById('btn-isolated').classList.toggle('active', mode === 'isolated');
        document.getElementById('btn-cross').classList.toggle('active', mode === 'cross');
        document.getElementById('cross-balance-group').style.display = mode === 'cross' ? 'block' : 'none';
        document.getElementById('liq-type-label').innerText = mode === 'isolated' ? 'Isolated Liquidation' : 'Cross Liquidation';
        calculate();
    }

    function calculate() {
        const cap = parseFormattedNumber(document.getElementById('v_cap').value);
        const rp = parseFormattedNumber(document.getElementById('v_riskP').value);
        const ent = parseFormattedNumber(document.getElementById('v_entry').value);
        const sl = parseFormattedNumber(document.getElementById('v_sl').value);
        const tgt = parseFormattedNumber(document.getElementById('v_target').value);
        const walletIn = document.getElementById('v_wallet').value;
        const wallet = walletIn !== "" ? parseFormattedNumber(walletIn) : cap;
        
        const isLevOnLeft = document.getElementById('lbl_left').innerText === "Leverage";
        const levInput = isLevOnLeft ? document.getElementById('in_left') : document.getElementById('in_right');
        const traInput = isLevOnLeft ? document.getElementById('in_right') : document.getElementById('in_left');
        const lev = parseFormattedNumber(levInput.value) || 1;
        const badge = document.getElementById('type-badge');

        if (cap && rp) {
            const riskAmt = (cap * rp) / 100;
            document.getElementById('v_risk_top').innerText = "$" + formatNumberWithCommas(Math.round(riskAmt));
            document.getElementById('v_risk_amt').innerText = "-" + formatNumberWithCommas(Math.round(riskAmt));
        }

        if (cap && rp && ent && sl && Math.abs(ent - sl) > 0) {
            const riskAmt = (cap * rp) / 100;
            const diff = Math.abs(ent - sl);
            const ps = (riskAmt / diff) * ent;
            const psUnits = ps / ent;
            
            document.getElementById('res_size').innerText = formatNumberWithCommas(Math.round(ps));
            traInput.value = formatNumberWithCommas((ps / lev).toFixed(2));

            const isLong = sl < ent;
            badge.style.display = 'block';
            badge.innerText = isLong ? 'LONG' : 'SHORT';
            badge.className = 'trade-type-badge ' + (isLong ? 'type-long' : 'type-short');

            const mmr = 0.005; 
            let liq = 0;
            if (marginMode === 'isolated') {
                liq = isLong ? ent * (1 - (1/lev) + mmr) : ent * (1 + (1/lev) - mmr);
            } else {
                liq = isLong ? ent - (wallet / psUnits) + (ent * mmr) : ent + (wallet / psUnits) - (ent * mmr);
            }
            document.getElementById('v_liq').innerText = liq > 0 ? formatNumberWithCommas(liq.toFixed(4)) : "0.0000";

            if (tgt) {
                const rewardDist = Math.abs(tgt - ent);
                const pf = (ps / ent) * rewardDist;
                document.getElementById('v_profit').innerText = "+" + formatNumberWithCommas(Math.round(pf));
                document.getElementById('v_rr').innerText = "1:" + (rewardDist / diff).toFixed(2);
            }
        } else {
            badge.style.display = 'none';
            document.getElementById('res_size').innerText = "0";
            document.getElementById('v_liq').innerText = "0.0000";
            document.getElementById('v_rr').innerText = "0";
            document.getElementById('v_profit').innerText = "0";
            traInput.value = "";
        }
    }

    function swapFields() {
        const l1 = document.getElementById('lbl_left'), l2 = document.getElementById('lbl_right');
        const i1 = document.getElementById('in_left'), i2 = document.getElementById('in_right');
        const tL = l1.innerText; l1.innerText = l2.innerText; l2.innerText = tL;
        const tV = i1.value; i1.value = i2.value; i2.value = tV;
        i1.readOnly = (l1.innerText === "Trade Amount");
        i2.readOnly = (l2.innerText === "Trade Amount");
        calculate();
    }

    function copySize() {
        const val = document.getElementById('res_size').innerText.replace(/,/g, '');
        if(val && val !== "0") {
            navigator.clipboard.writeText(val).then(() => alert("Copied: " + val));
        }
    }

    function resetForm() {
        if(confirm("Reset အကုန်လုပ်မှာ သေချာပါသလား?")) {
            const ids = ["v_cap","v_riskP","v_entry","v_sl","v_target","v_wallet","in_left","in_right"];
            ids.forEach(id => document.getElementById(id).value = "");
            document.getElementById('res_size').innerText = "0";
            document.getElementById('v_liq').innerText = "0.0000";
            document.getElementById('v_risk_top').innerText = "$0";
            document.getElementById('v_profit').innerText = "0";
            document.getElementById('v_risk_amt').innerText = "0";
            document.getElementById('v_rr').innerText = "0";
            document.getElementById('type-badge').style.display = "none";
        }
    }
</script>
</body>
</html>
